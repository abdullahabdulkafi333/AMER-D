<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø±ÙƒØ© Ø¹Ø§Ù…Ø± Ø¯Ù‡ÙŠÙ…Ø´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; color: #0f172a; scroll-behavior: smooth; }
        .premium-header { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding-bottom: 5rem; }
        .header-line { height: 4px; width: 80px; background: linear-gradient(90deg, transparent, #3b82f6, transparent); margin: 12px auto 0; border-radius: 2px; }
        .sticky-header { position: sticky; top: 0; z-index: 40; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid #e2e8f0; }
        .table-container { border-radius: 24px; overflow: hidden; box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05); background: white; border: 1px solid #e2e8f0; }
        .price-text { font-size: 1rem; font-weight: 800; color: #1e40af; }
        .admin-input-cell { background: #fdfdfd; border: 1px solid #f1f5f9; border-radius: 8px; padding: 4px 8px; width: 100%; outline: none; }
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø³Ø±ÙŠØ¹ */
        .fade-in-row { animation: fadeIn 0.3s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header class="premium-header text-white pt-16 text-center cursor-pointer select-none" onclick="loginAdmin()">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-6xl font-black tracking-tight drop-shadow-xl">Ø´Ø±ÙƒØ© Ø¹Ø§Ù…Ø± Ø¯Ù‡ÙŠÙ…Ø´</h1>
            <div class="header-line"></div>
        </div>
    </header>

    <div class="container mx-auto px-2 md:px-4 max-w-5xl -mt-16">
        
        <div id="adminPanel" class="hidden bg-white rounded-[32px] shadow-2xl p-6 md:p-10 mb-10 border border-slate-200 overflow-hidden">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-xl font-black">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</h2>
                <button onclick="toggleAdmin()" class="text-slate-300 text-3xl">&times;</button>
            </div>

            <div class="bg-slate-50 p-4 rounded-2xl mb-6">
                <p class="text-[11px] text-blue-600 font-bold mb-3">âš ï¸ Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„ØµÙˆØ± ÙŠØªÙ… Ø¶ØºØ·Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†.</p>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input type="text" id="itemName" placeholder="Ø§Ù„ØµÙ†Ù" class="p-3 rounded-xl border outline-none">
                    <input type="text" id="itemPack" placeholder="Ø§Ù„ØªØ¹Ø¨Ø¦Ø©" class="p-3 rounded-xl border outline-none">
                    <input type="text" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="p-3 rounded-xl border outline-none font-bold">
                    <input type="file" id="itemFile" accept="image/*" class="text-[10px] mt-2">
                </div>
                <button onclick="addItem()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold mt-4">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø¸ØºÙˆØ·</button>
            </div>

            <div class="overflow-x-auto rounded-xl border mb-6">
                <table class="w-full text-right text-xs">
                    <thead class="bg-slate-800 text-white">
                        <tr>
                            <th class="p-3">Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th class="p-3">Ø§Ù„ØµÙ†Ù</th>
                            <th class="p-3">Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</th>
                            <th class="p-3">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th class="p-3">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                            <th class="p-3">Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>

            <div class="bg-slate-900 p-5 rounded-2xl">
                <textarea id="outputJson" class="w-full h-24 bg-transparent text-slate-500 text-[10px] outline-none border-none resize-none" readonly></textarea>
                <button onclick="copyJson()" class="w-full bg-blue-500 text-white py-3 rounded-xl font-bold mt-2 text-sm">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø« ğŸ“‹</button>
            </div>
        </div>

        <div class="relative mb-6 max-w-2xl mx-auto">
            <input type="text" id="searchInput" onkeyup="search()" placeholder="Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." 
                   class="w-full p-5 pr-12 rounded-3xl shadow-lg border-none outline-none text-lg">
            <span class="absolute right-4 top-5 opacity-20 text-xl">ğŸ”</span>
        </div>

        <div class="table-container overflow-x-auto">
            <table class="w-full text-right">
                <thead class="sticky-header">
                    <tr class="border-b">
                        <th class="p-4 text-slate-400 font-bold text-xs uppercase">Ø§Ù„ØµÙˆØ±Ø©</th>
                        <th class="p-4 text-slate-400 font-bold text-xs uppercase">Ø§Ù„ØµÙ†Ù</th>
                        <th class="p-4 text-slate-400 font-bold text-xs uppercase">Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</th>
                        <th class="p-4 text-slate-400 font-bold text-xs uppercase">Ø§Ù„Ø³Ø¹Ø±</th>
                    </tr>
                </thead>
                <tbody id="grid" class="divide-y divide-slate-50"></tbody>
            </table>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/90 backdrop-blur-md" onclick="this.style.display='none'">
        <img id="zoomImg" src="" class="max-w-full max-h-[85vh] rounded-2xl shadow-2xl">
    </div>

    <script>
        let products = [];

        async function loadData() {
            try {
                const res = await fetch('data.json?t=' + Date.now());
                products = await res.json();
                renderUI();
            } catch (e) {
                document.getElementById('grid').innerHTML = '<tr><td colspan="4" class="p-20 text-center opacity-30">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>';
            }
        }

        function renderUI() {
            const grid = document.getElementById('grid');
            const adminTable = document.getElementById('adminTableBody');
            grid.innerHTML = '';
            adminTable.innerHTML = '';

            products.forEach((item, index) => {
                grid.innerHTML += `
                    <tr class="fade-in-row">
                        <td class="p-3 w-24">
                            <img data-src="${item.img}" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" 
                                 onclick="zoom('${item.img}')" class="lazy-img w-16 h-16 md:w-20 md:h-20 object-cover rounded-2xl cursor-zoom-in bg-gray-100">
                        </td>
                        <td class="p-3"><h3 class="text-sm font-bold text-slate-800">${item.name}</h3></td>
                        <td class="p-3"><span class="text-xs font-black text-slate-900 bg-slate-100 px-3 py-1 rounded-full">${item.pack}</span></td>
                        <td class="p-3"><span class="price-text">${item.price}</span></td>
                    </tr>`;

                adminTable.innerHTML += `
                    <tr class="border-b">
                        <td class="p-2"><img src="${item.img}" class="w-10 h-10 object-cover rounded-lg"></td>
                        <td class="p-2"><input type="text" value="${item.name}" oninput="updateVal(${index}, 'name', this.value)" class="admin-input-cell font-bold"></td>
                        <td class="p-2"><input type="text" value="${item.pack}" oninput="updateVal(${index}, 'pack', this.value)" class="admin-input-cell"></td>
                        <td class="p-2"><input type="text" value="${item.price}" oninput="updateVal(${index}, 'price', this.value)" class="admin-input-cell font-black text-blue-600"></td>
                        <td class="p-2"><div class="flex gap-1"><button onclick="moveItem(${index},-1)">ğŸ”¼</button><button onclick="moveItem(${index},1)">ğŸ”½</button></div></td>
                        <td class="p-2 text-center"><button onclick="deleteItem(${index})" class="text-red-300 hover:text-red-500">ğŸ—‘</button></td>
                    </tr>`;
            });
            updateOutput();
            initLazyLoading();
        }

        // Ù…ÙŠØ²Ø© Ø¶ØºØ· Ø§Ù„ØµÙˆØ± Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…
        async function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 400; // Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
                        const scaleSize = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6)); // Ø¬ÙˆØ¯Ø© 60% Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ø¬Ø¯Ø§Ù‹ Ù…Ø¹ ÙˆØ¶ÙˆØ­ ÙƒØ§ÙÙŠ
                    };
                };
            });
        }

        async function addItem() {
            const file = document.getElementById('itemFile').files[0];
            const name = document.getElementById('itemName').value;
            const pack = document.getElementById('itemPack').value;
            const price = document.getElementById('itemPrice').value;

            if (!file || !name) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙˆØ§Ø³Ù…");

            const compressedImg = await compressImage(file);
            products.push({ name, pack, price, img: compressedImg });
            renderUI();
            document.getElementById('itemFile').value = '';
        }

        function initLazyLoading() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        observer.unobserve(img);
                    }
                });
            });
            document.querySelectorAll('.lazy-img').forEach(img => observer.observe(img));
        }

        function updateVal(index, key, val) { products[index][key] = val; updateOutput(); }
        function moveItem(index, dir) { 
            const newIdx = index + dir;
            if(newIdx >= 0 && newIdx < products.length) {
                [products[index], products[newIdx]] = [products[newIdx], products[index]];
                renderUI();
            }
        }
        function deleteItem(index) { if(confirm('Ø­Ø°ÙØŸ')) { products.splice(index, 1); renderUI(); } }
        function updateOutput() { document.getElementById('outputJson').value = JSON.stringify(products); }
        function copyJson() {
            const text = document.getElementById('outputJson');
            text.select();
            document.execCommand('copy');
            alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®! Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¢Ù† Ø£ØµØ¨Ø­ Ø£ØµØºØ± Ø¨ÙƒØ«ÙŠØ±.");
        }
        function zoom(src) { document.getElementById('zoomImg').src = src; document.getElementById('modal').style.display = 'flex'; }
        function search() {
            let q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#grid tr').forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(q) ? 'table-row' : 'none';
            });
        }
        function loginAdmin() { if(prompt("Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:") === "admin123") toggleAdmin(); }
        function toggleAdmin() { document.getElementById('adminPanel').classList.toggle('hidden'); }

        loadData();
    </script>
</body>
</html>
